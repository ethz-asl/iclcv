CMAKE_MINIMUM_REQUIRED(VERSION 2.6)
PROJECT(ICL)
cmake_policy(SET CMP0002 OLD)
#set(CMAKE_VERBOSE_MAKEFILE ON)
SET(CMAKE_BUILD_TYPE "Release")
if(${CMAKE_BUILD_TYPE} STREQUAL "Release" OR ${CMAKE_BUILD_TYPE} STREQUAL "")
#SET(CMAKE_CXX_FLAGS "-O4 -funroll-loops -march=native")
else()
#SET(CMAKE_CXX_FLAGS "-Wall O0 -g3")
SET(CMAKE_BUILD_TYPE "Debug")
endif()
message(STATUS "Build type: ${CMAKE_BUILD_TYPE}")
#TODO
set(CMAKE_INSTALL_PREFIX "/homes/cgroszew/ICL")
message(STATUS "Install Path: ${CMAKE_INSTALL_PREFIX}")
if(UNIX)
    add_definitions( -DSYSTEM_LINUX)
    add_definitions( -DICL_SYSTEM_LINUX)
    set(SYSTEM_LINUX_COND TRUE)
endif()
if(APPLE)
    add_definitions( -DSYSTEM_APPLE)
endif()
if(WIN32)
    add_definitions( -DSYSTEM_WINDOWS)
    add_definitions( -DICL_SYSTEM_WINDOWS)
endif()

set(BUILD_EXAMPLES OFF CACHE BOOL "Build example applications")

#check for IPP default check location /vol/nivision/IPP/6.1-ia32
find_path(IPP_PATH "ipp.h" "/vol/nivision/IPP/6.1-ia32/include" DOC "The path to IPP")
if(IPP_PATH)
set(IPP_FOUND TRUE)
set(HAVE_IPP_COND TRUE)
add_definitions( -DHAVE_IPP)
set(USE_IPP ON CACHE BOOL "Use IPP when available")
include_directories("${IPP_PATH}")
link_directories("/vol/nivision/IPP/6.1-ia32/sharedlib")
else()
set(IPP_FOUND FALSE)
set(HAVE_IPP_COND FALSE)
set(USE_IPP OFF CACHE BOOL "Use IPP when available")
endif()
message(STATUS "IPP detected: ${IPP_FOUND}")

#check for MKL
find_path(MKL_PATH "mkl.h" "/vol/nivision/MKL/10.2/include" DOC "The path to MKL")
if(MKL_PATH)
set(MKL_FOUND TRUE)
set(USE_MKL ON CACHE BOOL "Use MKL when available")
set(HAVE_MKL_COND TRUE)
add_definitions( -DHAVE_MKL)
include_directories("${MKL_PATH}")
link_directories("/vol/nivision/MKL/10.2/lib/32")
else()
set(MKL_FOUND FALSE)
set(HAVE_MKL_COND FALSE)
set(USE_MKL OFF CACHE BOOL "Use MKL when available")
endif()
message(STATUS "MKL detected: ${MKL_FOUND}")

#check for OpenCV
find_path(OPENCV_PATH "cxtypes.h" "/vol/nivision/OpenCV2/include/opencv" DOC "The path to OpenCV")
#find_path(OPENCV_PATH "cxtypes.h" "/opt/OpenCV2/include/opencv" DOC "The path to OpenCV")
if(OPENCV_PATH)
set(OPENCV_FOUND TRUE)
set(USE_OPENCV ON CACHE BOOL "Use OpenCV when available")
set(HAVE_OPENCV_COND TRUE)
add_definitions( -DHAVE_OPENCV)
include_directories("${OPENCV_PATH}")
link_directories("/vol/nivision/OpenCV2/lib")
else()
set(OPENCV_FOUND FALSE)
set(HAVE_OPENCV_COND FALSE)
set(USE_OPENCV OFF CACHE BOOL "Use OpenCV when available")
endif()
message(STATUS "OpenCV detected: ${OPENCV_FOUND}")
#endif(UNIX)

#check for HAVE_LIBZ_COND
find_path(LIBZ_PATH "zlib.h" "/usr/include" DOC "The path to libz")
if(LIBZ_PATH)
set(LIBZ_FOUND TRUE)
set(USE_LIBZ ON CACHE BOOL "Use libz when available")
set(HAVE_LIBZ_COND TRUE)
add_definitions( -DHAVE_LIBZ)
include_directories("${LIBZ_PATH}")
link_directories("/usr/lib")
else()
set(LIBZ_FOUND FALSE)
set(HAVE_LIBZ_COND FALSE)
set(USE_LIBZ OFF CACHE BOOL "Use libz when available")
endif()
message(STATUS "libz detected: ${LIBZ_FOUND}")

#check for HAVE_LIBMESASR_COND
#find_path(LIBMESASR_PATH "libMesaSR.h" "/usr/include" DOC "The path to libmesasr")
find_path(LIBMESASR_PATH "libMesaSR.h" "/vol/nivision/include" DOC "The path to libmesasr")
if(LIBMESASR_PATH)
set(LIBMESASR_FOUND TRUE)
set(USE_LIBMESASR ON CACHE BOOL "Use libmesasr when available")
set(HAVE_LIBMESASR_COND TRUE)
add_definitions( -DHAVE_LIBMESASR)
include_directories("${LIBMESASR_PATH}")
#link_directories("/usr/lib")
link_directories("/vol/nivision/lib")
else()
set(LIBMESASR_FOUND FALSE)
set(HAVE_LIBMESASR_COND FALSE)
set(USE_LIBMESASR OFF CACHE BOOL "Use libmesasr when available")
endif()
message(STATUS "libmesasr detected: ${LIBMESASR_FOUND}")

#check for HAVE_LIBJPEG_COND
#FINDJPEG
find_path(LIBJPEG_PATH "jpeglib.h" "/usr/include" DOC "The path to libjpeg")
if(LIBJPEG_PATH)
set(LIBJPEG_FOUND TRUE)
set(USE_LIBJPEG ON CACHE BOOL "Use libjpeg when available")
set(HAVE_LIBJPEG_COND TRUE)
add_definitions( -DHAVE_LIBJPEG)
include_directories("${LIBJPEG_PATH}")
link_directories("/usr/lib")
else()
set(LIBJPEG_FOUND FALSE)
set(HAVE_LIBJPEG_COND FALSE)
set(USE_LIBJPEG OFF CACHE BOOL "Use libjpeg when available")
endif()
message(STATUS "libjpeg detected: ${LIBJPEG_FOUND}")

#check for HAVE_LIBMAGICK_COND
find_path(IMAGEMAGICK_PATH "Magick++.h" "/usr/include/GraphicsMagick" DOC "The path to Magick++")
if(IMAGEMAGICK_PATH)
set(HAVE_IMAGEMAGICK_COND TRUE)
add_definitions( -DHAVE_IMAGEMAGICK)
set(IMAGEMAGICK_FOUND TRUE)
set(USE_IMAGEMAGICK ON CACHE BOOL "Use Magick++ when available")
include_directories("${IMAGEMAGICK_PATH}")
link_directories("/usr/lib")
else()
set(IMAGEMAGICK_FOUND FALSE)
set(HAVE_IMAGEMAGICK_COND FALSE)
set(USE_IMAGEMAGICK OFF CACHE BOOL "Use Magick++ when available")
endif()
message(STATUS "Magick++ detected: ${IMAGEMAGICK_FOUND}")
message(STATUS "Magick++ detected2: ${HAVE_IMAGEMAGICK_COND}")
message(STATUS "Magick++ detected3: ${USE_IMAGEMAGICK}")

#check for HAVE_LIBDC_COND
find_path(LIBDC_PATH "dc1394.h" "/vol/nivision/include/dc1394" DOC "The path to dc")
#find_path(LIBDC_PATH "dc1394.h" "/usr/include/dc1394" DOC "The path to dc")
if(LIBDC_PATH)
set(LIBDC_FOUND TRUE)
set(USE_LIBDC ON CACHE BOOL "Use dc when available")
set(HAVE_LIBDC_COND TRUE)
add_definitions( -DHAVE_LIBDC)
include_directories("${LIBDC_PATH}")
link_directories("/vol/nivision/lib")
else()
set(LIBDC_FOUND FALSE)
set(HAVE_LIBDC_COND FALSE)
set(USE_LIBDC OFF CACHE BOOL "Use dc when available")
endif()
message(STATUS "dc detected: ${LIBDC_FOUND}")

#check for HAVE_UNICAP_COND
find_path(UNICAP_PATH "unicap.h" "/vol/nivision/include/unicap" DOC "The path to Unicap")
#find_path(UNICAP_PATH "unicap.h" "/usr/include/unicap" DOC "The path to Unicap")
if(UNICAP_PATH)
set(UNICAP_FOUND TRUE)
set(USE_UNICAP ON CACHE BOOL "Use Unicap when available")
set(HAVE_UNICAP_COND TRUE)
add_definitions( -DHAVE_UNICAP)
add_definitions(-DUNICAP_FLAGS_NOT_AS_ENUM)
include_directories("${UNICAP_PATH}")
#link_directories("${UNICAP_PATH}/../../lib")
#link_directories("/usr/lib")
link_directories("/vol/nivision/lib/unicap/cpi")
else()
set(UNICAP_FOUND FALSE)
set(HAVE_UNICAP_COND FALSE)
set(USE_UNICAP OFF CACHE BOOL "Use Unicap when available")
endif()
message(STATUS "Unicap detected: ${UNICAP_FOUND}")

#check for HAVE_XINE_COND
#find_path(XINE_PATH "xine.h" "/usr/include/" DOC "The path to Xine")
find_path(XINE_PATH "xine.h" "/vol/nivision/include/" DOC "The path to Xine")
if(XINE_PATH)
set(XINE_FOUND TRUE)
set(USE_XINE ON CACHE BOOL "Use Xine when available")
set(HAVE_XINE_COND TRUE)
add_definitions( -DHAVE_XINE)
include_directories("${XINE_PATH}")
include_directories("${XINE_PATH}/xine")
#link_directories("/usr/lib")
link_directories("/vol/nivision/lib")
else()
set(XINE_FOUND FALSE)
set(HAVE_XINE_COND FALSE)
set(USE_XINE OFF CACHE BOOL "Use Xine when available")
endif()
message(STATUS "Xine detected: ${XINE_FOUND}")

#check for HAVE_XCF_COND
find_path(XCF_PATH "XCFBase.hpp" "/vol/xcf/include/xcf" DOC "The path to XCF")
#find_path(XCF_PATH "XCFBase.hpp" "/opt/xcf/include/xcf" DOC "The path to XCF")
if(XCF_PATH)
set(XCF_FOUND TRUE)
set(USE_XCF ON CACHE BOOL "Use XCF when available")
set(HAVE_XCF_COND TRUE)
add_definitions( -DHAVE_XCF)
include_directories("${XCF_PATH}")
include_directories("/vol/xcf/include")
link_directories("/vol/xcf/lib")
else()
set(XCF_FOUND FALSE)
set(HAVE_XCF_COND FALSE)
set(USE_XCF OFF CACHE BOOL "Use XCF when available")
endif()
message(STATUS "XCF detected: ${XCF_FOUND}")

# QT4 Handling
FIND_PACKAGE(Qt4 COMPONENTS QtCore QtGui QtOpenGL REQUIRED)
add_definitions( -DHAVE_QT)
INCLUDE(${QT_USE_FILE})
set(HAVE_Qt_COND TRUE)
include_directories("/usr/include/qt4")
include_directories("/usr/include/qt4/QtOpenGL")
include_directories("/usr/include/qt4/QtCore")
include_directories("/usr/include/qt4/QtGui")
link_directories("/usr/lib")

#OpenGL
find_path(OPENGL_PATH "gl.h" "/usr/include/GL" DOC "The path to XCF")
if(OPENGL_PATH)
set(OPENGL_FOUND TRUE)
set(USE_OPENGL ON CACHE BOOL "Use OPENGL when available")
set(HAVE_OPENGL_COND TRUE)
add_definitions( -DHAVE_OPENGL)
include_directories("/usr/include/GL")
link_directories("/usr/lib")
else()
set(OPENGL_FOUND FALSE)
set(HAVE_OPENGL_COND FALSE)
set(USE_OPENGL OFF CACHE BOOL "Use XCF when available")
endif()
message(STATUS "OpenGL detected: ${OPENGL_FOUND}")

#SVS
find_path(SVS_PATH "dcam.h" "/vol/nivision/SVS/4.2/src" DOC "The path to XCF")
if(SVS_PATH)
set(SVS_FOUND TRUE)
set(USE_SVS ON CACHE BOOL "Use SVS when available")
set(HAVE_SVS_COND TRUE)
add_definitions( -DHAVE_SVS)
include_directories("/vol/nivision/SVS/4.2/src")
link_directories("/vol/nivision/SVS/4.2/bin")
else()
set(SVS_FOUND FALSE)
set(HAVE_SVS_COND FALSE)
set(USE_SVS OFF CACHE BOOL "Use SVS when available")
endif()
message(STATUS "SVS detected: ${SVS_FOUND}")

include_directories(${PROJECT_SOURCE_DIR}/include)

include(UseDoxygen OPTIONAL)
FIND_PACKAGE(Doxygen)

#add subdirs
add_subdirectory(ICLUtils)
add_subdirectory(ICLCore)
add_subdirectory(ICLCC)
add_subdirectory(ICLFilter)
add_subdirectory(ICLBlob)
add_subdirectory(ICLOpenCV)
add_subdirectory(ICLIO)
add_subdirectory(ICLQt)
add_subdirectory(ICLQuick)
add_subdirectory(ICLGeom)
add_subdirectory(ICLAlgorithms)

install (DIRECTORY ${CMAKE_SOURCE_DIR}/include/
         DESTINATION ${CMAKE_INSTALL_PREFIX}/include/ICL
)

if(DOXYGEN_FOUND)
install(DIRECTORY ${CMAKE_SOURCE_DIR}/doc/
         DESTINATION ${CMAKE_INSTALL_PREFIX}/doc/ICL
)
# cat doxyfile | sed "s|ICL_SUB_PACKAGE_PLACEHOLDER|${subdir}|g" > doxyfile)
# prepare doxygen configuration file
set(ICL_SUB_PACKAGE_PLACEHOLDER2 ICLUtils ICLCore ICLCC ICLFilter ICLBlob ICLOpenCV ICLIO ICLQt ICLQuick ICLGeom ICLAlgorithms)
foreach(ICL_SUB_PACKAGE_PLACEHOLDER ${ICL_SUB_PACKAGE_PLACEHOLDER2})
    configure_file(doxyfile.in ${CMAKE_CURRENT_BINARY_DIR}/${ICL_SUB_PACKAGE_PLACEHOLDER}/doc/doxyfile @ONLY)


configure_file(${ICL_SUB_PACKAGE_PLACEHOLDER}/doc/ ${CMAKE_CURRENT_BINARY_DIR}/${ICL_SUB_PACKAGE_PLACEHOLDER}/doc/ COPYONLY)

    #copy pics
	file(GLOB templateFiles RELATIVE ${ICL_SUB_PACKAGE_PLACEHOLDER}/doc/ ${ICL_SUB_PACKAGE_PLACEHOLDER}/doc/*)
message(STATUS "files ${templateFiles} ${CMAKE_SOURCE_DIR}/${ICL_SUB_PACKAGE_PLACEHOLDER}/doc/")
		foreach(templateFile ${templateFiles})
        		set(srcTemplatePath ${ICL_SUB_PACKAGE_PLACEHOLDER}/doc/${templateFile})
 message(STATUS "file ${templateFile}")
        if(NOT IS_DIRECTORY ${srcTemplatePath})
            message(STATUS "Configuring file ${templateFile}")
            configure_file(
                    ${srcTemplatePath}
                    ${CMAKE_CURRENT_BINARY_DIR}/${ICL_SUB_PACKAGE_PLACEHOLDER}/doc/${templateFile}
                    COPYONLY)
        endif(NOT IS_DIRECTORY ${srcTemplatePath})
    endforeach(templateFile)
endforeach()

# add doxygen as dependency to doc-target
get_target_property(DOC_TARGET doc TYPE)
if(NOT DOC_TARGET)
	add_custom_target(doc)
endif()
endif()
